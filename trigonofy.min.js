function m(r,t){r<0&&(r=0),t<0&&(t=0),r>t&&([r,t]=[t,r]);let e=t-r,n=Math.floor(Math.random()*(e+1));return r+n}var P=class{static random(t,e,n){switch(m(1,2)){case 1:return this.uniform(t,e,n);case 2:default:return this.grid(t,e,n)}}static uniform(t,e,n){t<0&&(t=0),e<0&&(e=0),(n==null||n<=0)&&(n=v(t,e));let i=Math.max(Math.min(t,e)/2,n),o=t+2*i,l=e+2*i,s=Math.ceil(l/n),a=Math.ceil(o/n),h=s*a,b=[];for(let f=0;f<h;f++){let c=Math.round(Math.random()*o-i),d=Math.round(Math.random()*l-i);b.push([c,d])}return b}static grid(t,e,n,i){t<0&&(t=0),e<0&&(e=0),i<0?i=0:i>1?i=1:i==null&&(i=Math.random()),(n==null||n<=0)&&(n=v(t,e));let o=Math.max(Math.min(t,e)/2,n),[l,s]=[-o,t+o],[a,h]=[-o,e+o],b=()=>{let c=Math.round(Math.random()),d=Math.round(Math.random()*n*i);return c===1?d:-d},f=[];for(let c=l;c<=s;c+=n)for(let d=a;d<=h;d+=n)f.push([c+b(),d+b()]);return f}};function v(r,t){let e=Math.min(r,t),n=Math.min(e,50),i=Math.floor(e/5);return m(n,i)}import u from"chroma-js";var M=class{static random(t){switch(m(1,7)){case 1:return this.chaos(t);case 2:return this.complementary(t);case 3:return this.monochromatic(t);case 4:return this.analogous(t);case 5:return this.triadic(t);case 6:return this.tetradic(t);case 7:default:return this.colorbrewer()}}static chaos(t){let n=[g(t)],i=m(4,10);for(let o=1;o<4;o++)n.push(k(n[o-1]));return u.scale(n).mode("lch").colors(i)}static complementary(t){let e=g(t),[n,i,o]=e.hsl(),l=u.hsl(n-180,i,o),s=m(4,10);return u.scale([e,l]).mode("lch").colors(s)}static monochromatic(t){let e=g(t),[n,i,o]=e.hsl(),l=m(4,10),s=1/(l+1),a=[];for(let h=l;h>=1;h--)a.push(u.hsl(n,i,h*s).hex());return a}static analogous(t){let e=g(t),[n,i,o]=e.hsl(),l=u.hsl(n+30,i,o),s=u.hsl(n+60,i,o),a=m(4,10);return u.scale([e,l,s]).mode("lch").colors(a)}static triadic(t){let e=g(t),[n,i,o]=e.hsl(),l=u.hsl(n+120,i,o),s=u.hsl(n+240,i,o),a=m(4,10);return u.scale([e,l,s]).mode("lch").colors(a)}static tetradic(t){let e=g(t),[n,i,o]=e.hsl(),l=u.hsl(n+90,i,o),s=u.hsl(n+180,i,o),a=u.hsl(n+270,i,o),h=m(4,10);return u.scale([e,l,s,a]).mode("lch").colors(h)}static colorbrewer(t){let e=Object.keys(u.brewer);if(t!=null&&t in e)return u.brewer[t];{let n=Math.floor(Math.random()*e.length);return u.brewer[e[n]]}}};function g(r){return u.valid(r)?u(r):u.random()}function k(r){if(r==null)return u.random();let t=m(1,3),[e,n,i]=r.hsl();switch(t){case 1:e=m(1,360);case 2:n=Math.random();case 3:default:i=Math.random()}return u.hsl(e,n,i)}import C from"chroma-js";import{Delaunay as D}from"d3-delaunay";var R=class{constructor(t={}){t=I(t),this.width=t.width,this.height=t.height,this.points=t.points,this.palette=t.palette}renderRandom(t,{lineWidth:e=2,gradientAngle:n=void 0}={}){let i={lineWidth:e,gradientAngle:n};return m(1,2)===1?this.renderTriangle(t,i):this.renderVoronoi(t,i)}renderTriangle(t,{lineWidth:e=1,gradientAngle:n=void 0}={}){O(n)||(n=m(0,360)),n=G(n),this._initiateContext(t,e,n),t.fillRect(0,0,this.width,this.height);let i=D.from(this.points);[...i.trianglePolygons()].forEach(o=>{if(!o.some(h=>{let[b,f]=[h[0],h[1]];return b>=0&&b<=this.width&&f>=0&&f<=this.height}))return;let s=(o[0][0]+o[1][0]+o[2][0])/3;s<=0?s=1:s>=this.width&&(s=this.width-1);let a=(o[0][1]+o[1][1]+o[2][1])/3;a<=0?a=1:a>=this.height&&(a=this.height-1),t.fillStyle=V(t,s,a),_(t,o),t.fill()}),e>0&&(t.beginPath(),i.render(t),t.stroke())}renderVoronoi(t,{lineWidth:e=1,gradientAngle:n=void 0}={}){O(n)||(n=m(0,360)),n=G(n),this._initiateContext(t,e,n),t.fillRect(0,0,this.width,this.height);let o=D.from(this.points).voronoi([0,0,this.width,this.height]);[...o.cellPolygons()].forEach(l=>{let[s,a]=[0,0],h=l.length-1;for(let c=0;c<h;c++)s+=l[c][0],a+=l[c][1];let b=s/h,f=a/h;t.fillStyle=V(t,b,f),_(t,l),t.fill()}),e>0&&(t.beginPath(),o.render(t),t.stroke())}_initiateContext(t,e,n){let i=this._createGradient(t,n),o=C.average(this.palette,"lch").luminance(),l=this.palette.map(a=>{let h=C(a);return h=o>=.5?h.darken():h.brighten(),h.hex()}),s=this._createGradient(t,n,l);t.lineWidth=e,t.fillStyle=i,t.strokeStyle=s}_createGradient(t,e,n){let{width:i,height:o}={...this};x(n)||(n=this.palette);let[l,s]=[i/2,0],[a,h]=[i/2,o];if(Math.abs(e)!==90){let c=Math.tan(e*Math.PI/180),d=i/2,p=o/2,[w,y]=[d,c*d];y>p?[w,y]=[p/c,p]:y<-p&&([w,y]=[-p/c,-p]),[a,h]=[Math.round(w+i/2),Math.round(y+o/2)],[l,s]=[i-a,o-h],c<0&&([l,a]=[a,l],[s,h]=[h,s])}let b=n.length,f=t.createLinearGradient(l,s,a,h);return n.forEach((c,d)=>{f.addColorStop(d/(b-1),c)}),f}};function I(r={}){return typeof r.width!="number"&&(r.width=800),typeof r.height!="number"&&(r.height=600),S(r.points)||(r.points=P.random(r.width,r.height)),x(r.palette)||(r.palette=M.random()),r}function S(r){return!Array.isArray(r)||r.length===0?!1:r.every(t=>Array.isArray(t)&&t.length===2&&isFinite(t[0])&&isFinite(t[1]))}function x(r){return!Array.isArray(r)||r.length<2?!1:r.every(t=>typeof t=="string"&&C.valid(t))}function O(r){return typeof r=="number"&&isFinite(r)}function G(r){if(r<0){for(;r<0;)r+=360;return r}else if(r>360){for(;r>360;)r-=360;return r}else return r}function V(r,t,e){let n=r.getImageData(t,e,1,1).data;return C.rgb(n[0],n[1],n[2]).hex()}function _(r,t){r.beginPath(),r.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)r.lineTo(t[e][0],t[e][1])}function Z(r){return new R(r)}export{M as Palette,R as Pattern,P as Points,Z as default};
