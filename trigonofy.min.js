function d(o,t){o<0&&(o=0),t<0&&(t=0),o>t&&([o,t]=[t,o]);let n=t-o,r=Math.floor(Math.random()*(n+1));return o+r}var M=class{static random(t,n,r){switch(d(1,2)){case 1:return this.uniform(t,n,r);case 2:default:return this.grid(t,n,r)}}static uniform(t,n,r){t<0&&(t=0),n<0&&(n=0),(r==null||r<=0)&&(r=v(t,n));let e=Math.max(Math.min(t,n)/2,r),i=t+2*e,s=n+2*e,l=Math.ceil(s/r),a=Math.ceil(i/r),c=l*a,u=[];for(let b=0;b<c;b++){let m=Math.round(Math.random()*i-e),f=Math.round(Math.random()*s-e);u.push([m,f])}return u}static grid(t,n,r,e){t<0&&(t=0),n<0&&(n=0),e<0?e=0:e>1?e=1:e==null&&(e=Math.random()),(r==null||r<=0)&&(r=v(t,n));let i=Math.max(Math.min(t,n)/2,r),[s,l]=[-i,t+i],[a,c]=[-i,n+i],u=()=>{let m=Math.round(Math.random()),f=Math.round(Math.random()*r*e);return m===1?f:-f},b=[];for(let m=s;m<=l;m+=r)for(let f=a;f<=c;f+=r)b.push([m+u(),f+u()]);return b}};function v(o,t){let n=Math.min(o,t),r=Math.min(n,50),e=Math.floor(n/5);return d(r,e)}import h from"chroma-js";var P=class{static random(t){switch(d(1,7)){case 1:return this.chaos(t);case 2:return this.complementary(t);case 3:return this.monochromatic(t);case 4:return this.analogous(t);case 5:return this.triadic(t);case 6:return this.tetradic(t);case 7:default:return this.colorbrewer()}}static chaos(t){let r=[y(t)],e=d(4,10);for(let i=1;i<4;i++)r.push(_(r[i-1]));return h.scale(r).mode("lch").colors(e)}static complementary(t){let n=y(t),[r,e,i]=n.hsl(),s=h.hsl(r-180,e,i),l=d(4,10);return h.scale([n,s]).mode("lch").colors(l)}static monochromatic(t){let n=y(t),[r,e,i]=n.hsl(),s=d(4,10),l=1/(s+1),a=[];for(let c=s;c>=1;c--)a.push(h.hsl(r,e,c*l).hex());return a}static analogous(t){let n=y(t),[r,e,i]=n.hsl(),s=h.hsl(r+30,e,i),l=h.hsl(r+60,e,i),a=d(4,10);return h.scale([n,s,l]).mode("lch").colors(a)}static triadic(t){let n=y(t),[r,e,i]=n.hsl(),s=h.hsl(r+120,e,i),l=h.hsl(r+240,e,i),a=d(4,10);return h.scale([n,s,l]).mode("lch").colors(a)}static tetradic(t){let n=y(t),[r,e,i]=n.hsl(),s=h.hsl(r+90,e,i),l=h.hsl(r+180,e,i),a=h.hsl(r+270,e,i),c=d(4,10);return h.scale([n,s,l,a]).mode("lch").colors(c)}static colorbrewer(t){let n=Object.keys(h.brewer);if(t!=null&&t in n)return h.brewer[t];{let r=Math.floor(Math.random()*n.length);return h.brewer[n[r]]}}};function y(o){return h.valid(o)?h(o):h.random()}function _(o){if(o==null)return h.random();let t=d(1,3),[n,r,e]=o.hsl();switch(t){case 1:n=d(1,360);case 2:r=Math.random();case 3:default:e=Math.random()}return h.hsl(n,r,e)}import x from"chroma-js";import{Delaunay as R}from"d3-delaunay";var C=class{constructor(t={}){t=k(t),this.width=t.width,this.height=t.height,this.points=t.points,this.palette=t.palette}renderRandom({lineWidth:t=2,gradientAngle:n=void 0}={}){let r=d(1,2),e={lineWidth:t,gradientAngle:n};return r===1?this.renderTriangle(e):this.renderVoronoi(e)}renderTriangle({lineWidth:t=2,gradientAngle:n=void 0}={}){O(n)||(n=d(0,360)),n=T(n);let[r,e]=this._prepareCanvas(t,n);return e.fillRect(0,0,this.width,this.height),[...R.from(this.points).trianglePolygons()].forEach(s=>{if(!s.some(u=>{let[b,m]=[u[0],u[1]];return b>=0&&b<=this.width&&m>=0&&m<=this.height}))return;let a=(s[0][0]+s[1][0]+s[2][0])/3;a<=0?a=1:a>=this.width&&(a=this.width-1);let c=(s[0][1]+s[1][1]+s[2][1])/3;c<=0?c=1:c>=this.height&&(c=this.height-1),e.fillStyle=G(e,a,c),V(e,s),t>0&&e.stroke(),e.fill()}),r}renderVoronoi({lineWidth:t=2,gradientAngle:n=void 0}={}){O(n)||(n=d(0,360)),n=T(n);let[r,e]=this._prepareCanvas(t,n);return e.fillRect(0,0,this.width,this.height),[...R.from(this.points).voronoi([0,0,this.width,this.height]).cellPolygons()].forEach(l=>{let[a,c]=[0,0],u=l.length-1;for(let f=0;f<u;f++)a+=l[f][0],c+=l[f][1];let b=a/u,m=c/u;e.fillStyle=G(e,b,m),V(e,l),t>0&&e.stroke(),e.fill()}),r}_createGradient(t,n,r){let{width:e,height:i}={...this};E(r)||(r=this.palette);let[s,l]=[e/2,0],[a,c]=[e/2,i];if(Math.abs(n)!==90){let m=Math.tan(n*Math.PI/180),f=e/2,p=i/2,[w,g]=[f,m*f];g>p?[w,g]=[p/m,p]:g<-p&&([w,g]=[-p/m,-p]),[a,c]=[Math.round(w+e/2),Math.round(g+i/2)],[s,l]=[e-a,i-c],m<0&&([s,a]=[a,s],[l,c]=[c,l])}let u=r.length,b=t.createLinearGradient(s,l,a,c);return r.forEach((m,f)=>{b.addColorStop(f/(u-1),m)}),b}_prepareCanvas(t,n){let r=document.createElement("canvas");r.width=this.width,r.height=this.height;let e=r.getContext("2d"),i=this._createGradient(e,n),s=x.average(this.palette,"lch").luminance(),l=this.palette.map(c=>{let u=x(c);return u=s>=.5?u.darken():u.brighten(),u.hex()}),a=this._createGradient(e,n,l);return e.lineWidth=t,e.fillStyle=i,e.strokeStyle=a,[r,e]}};function k(o={}){return typeof o.width!="number"&&(o.width=800),typeof o.height!="number"&&(o.height=600),D(o.points)||(o.points=M.random(o.width,o.height)),E(o.palette)||(o.palette=P.random()),o}function D(o){return!Array.isArray(o)||o.length===0?!1:o.every(t=>Array.isArray(t)&&t.length===2&&isFinite(t[0])&&isFinite(t[1]))}function E(o){return!Array.isArray(o)||o.length<2?!1:o.every(t=>typeof t=="string"&&x.valid(t))}function O(o){return typeof o=="number"&&isFinite(o)}function T(o){if(o<0){for(;o<0;)o+=360;return o}else if(o>360){for(;o>360;)o-=360;return o}else return o}function G(o,t,n){let r=o.getImageData(t,n,1,1).data;return x.rgb(r[0],r[1],r[2]).hex()}function V(o,t){o.beginPath(),o.moveTo(t[0][0],t[0][1]);for(let n=1;n<t.length;n++)o.lineTo(t[n][0],t[n][1])}function Z(o){return new C(o)}export{P as Palette,C as Pattern,M as Points,Z as default};
