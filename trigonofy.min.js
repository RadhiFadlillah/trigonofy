function d(o,t){o<0&&(o=0),t<0&&(t=0),o>t&&([o,t]=[t,o]);let n=t-o,e=Math.floor(Math.random()*(n+1));return o+e}var M=class{static random(t,n,e){switch(d(1,2)){case 1:return this.uniform(t,n,e);case 2:default:return this.grid(t,n,e)}}static uniform(t,n,e){t<0&&(t=0),n<0&&(n=0),(e==null||e<=0)&&(e=v(t,n));let r=Math.max(Math.min(t,n)/2,e),i=t+2*r,s=n+2*r,l=Math.ceil(s/e),a=Math.ceil(i/e),c=l*a,u=[];for(let b=0;b<c;b++){let m=Math.round(Math.random()*i-r),f=Math.round(Math.random()*s-r);u.push([m,f])}return u}static grid(t,n,e,r){t<0&&(t=0),n<0&&(n=0),r<0?r=0:r>1?r=1:r==null&&(r=Math.random()),(e==null||e<=0)&&(e=v(t,n));let i=Math.max(Math.min(t,n)/2,e),[s,l]=[-i,t+i],[a,c]=[-i,n+i],u=()=>{let m=Math.round(Math.random()),f=Math.round(Math.random()*e*r);return m===1?f:-f},b=[];for(let m=s;m<=l;m+=e)for(let f=a;f<=c;f+=e)b.push([m+u(),f+u()]);return b}};function v(o,t){let n=Math.min(o,t),e=Math.min(n,50),r=Math.floor(n/5);return d(e,r)}import h from"chroma-js";var P=class{static random(t){switch(d(1,7)){case 1:return this.chaos(t);case 2:return this.complementary(t);case 3:return this.monochromatic(t);case 4:return this.analogous(t);case 5:return this.triadic(t);case 6:return this.tetradic(t);case 7:default:return this.colorbrewer()}}static chaos(t){let e=[y(t)],r=d(4,10);for(let i=1;i<4;i++)e.push(D(e[i-1]));return h.scale(e).mode("lch").colors(r)}static complementary(t){let n=y(t),[e,r,i]=n.hsl(),s=h.hsl(e-180,r,i),l=d(4,10);return h.scale([n,s]).mode("lch").colors(l)}static monochromatic(t){let n=y(t),[e,r,i]=n.hsl(),s=d(4,10),l=1/(s+1),a=[];for(let c=s;c>=1;c--)a.push(h.hsl(e,r,c*l).hex());return a}static analogous(t){let n=y(t),[e,r,i]=n.hsl(),s=h.hsl(e+30,r,i),l=h.hsl(e+60,r,i),a=d(4,10);return h.scale([n,s,l]).mode("lch").colors(a)}static triadic(t){let n=y(t),[e,r,i]=n.hsl(),s=h.hsl(e+120,r,i),l=h.hsl(e+240,r,i),a=d(4,10);return h.scale([n,s,l]).mode("lch").colors(a)}static tetradic(t){let n=y(t),[e,r,i]=n.hsl(),s=h.hsl(e+90,r,i),l=h.hsl(e+180,r,i),a=h.hsl(e+270,r,i),c=d(4,10);return h.scale([n,s,l,a]).mode("lch").colors(c)}static colorbrewer(t){let n=Object.keys(h.brewer);if(t!=null&&t in n)return h.brewer[t];{let e=Math.floor(Math.random()*n.length);return h.brewer[n[e]]}}};function y(o){return h.valid(o)?h(o):h.random()}function D(o){if(o==null)return h.random();let t=d(1,3),[n,e,r]=o.hsl();switch(t){case 1:n=d(1,360);case 2:e=Math.random();case 3:default:r=Math.random()}return h.hsl(n,e,r)}import x from"chroma-js";import{Delaunay as O}from"d3-delaunay";var C=class{constructor(t={}){t=I(t),this.width=t.width,this.height=t.height,this.points=t.points,this.palette=t.palette}renderTriangle({lineWidth:t=2,gradientAngle:n=void 0}={}){E(n)||(n=d(0,360)),n=G(n);let[e,r]=this._prepareCanvas(t,n);return r.fillRect(0,0,this.width,this.height),[...O.from(this.points).trianglePolygons()].forEach(s=>{if(!s.some(u=>{let[b,m]=[u[0],u[1]];return b>=0&&b<=this.width&&m>=0&&m<=this.height}))return;let a=(s[0][0]+s[1][0]+s[2][0])/3;a<=0?a=1:a>=this.width&&(a=this.width-1);let c=(s[0][1]+s[1][1]+s[2][1])/3;c<=0?c=1:c>=this.height&&(c=this.height-1),r.fillStyle=_(r,a,c),k(r,s),t>0&&r.stroke(),r.fill()}),e}renderVoronoi({lineWidth:t=2,gradientAngle:n=void 0}={}){E(n)||(n=d(0,360)),n=G(n);let[e,r]=this._prepareCanvas(t,n);return r.fillRect(0,0,this.width,this.height),[...O.from(this.points).voronoi([0,0,this.width,this.height]).cellPolygons()].forEach(l=>{let[a,c]=[0,0],u=l.length-1;for(let f=0;f<u;f++)a+=l[f][0],c+=l[f][1];let b=a/u,m=c/u;r.fillStyle=_(r,b,m),k(r,l),t>0&&r.stroke(),r.fill()}),e}_createGradient(t,n,e){let{width:r,height:i}={...this};R(e)||(e=this.palette),n>180&&(n-=180);let[s,l]=[r/2,0],[a,c]=[r/2,i];if(n!==90){let m=Math.tan(n*Math.PI/180),f=r/2,p=i/2,[w,g]=[f,m*f];g>p?[w,g]=[p/m,p]:g<-p&&([w,g]=[-p/m,-p]),[a,c]=[Math.round(w+r/2),Math.round(g+i/2)],[s,l]=[r-a,i-c],m<0&&([s,a]=[a,s],[l,c]=[c,l])}let u=e.length,b=t.createLinearGradient(s,l,a,c);return e.forEach((m,f)=>{b.addColorStop(f/(u-1),m)}),b}_prepareCanvas(t,n){let e=document.createElement("canvas");e.width=this.width,e.height=this.height;let r=e.getContext("2d"),i=this._createGradient(r,n),s=x.average(this.palette,"lch").luminance(),l=this.palette.map(c=>{let u=x(c);return u=s>=.5?u.darken():u.brighten(),u.hex()}),a=this._createGradient(r,n,l);return r.lineWidth=t,r.fillStyle=i,r.strokeStyle=a,[e,r]}};function I(o={}){return typeof o.width!="number"&&(o.width=800),typeof o.height!="number"&&(o.height=600),T(o.points)||(o.points=M.random(o.width,o.height)),R(o.palette)||(o.palette=P.random()),o}function T(o){return!Array.isArray(o)||o.length===0?!1:o.every(t=>Array.isArray(t)&&t.length===2&&isFinite(t[0])&&isFinite(t[1]))}function R(o){return!Array.isArray(o)||o.length<2?!1:o.every(t=>typeof t=="string"&&x.valid(t))}function E(o){return typeof o=="number"&&isFinite(o)}function G(o){if(o<0){for(;o<0;)o+=360;return o}else if(o>360){for(;o>360;)o-=360;return o}else return o}function _(o,t,n){let e=o.getImageData(t,n,1,1).data;return x.rgb(e[0],e[1],e[2]).hex()}function k(o,t){o.beginPath(),o.moveTo(t[0][0],t[0][1]);for(let n=1;n<t.length;n++)o.lineTo(t[n][0],t[n][1])}function Z(o){return new C(o)}export{P as Palette,C as Pattern,M as Points,Z as default};
